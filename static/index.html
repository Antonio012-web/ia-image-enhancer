<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IA Image Enhancer</title>
  <link rel="stylesheet" href="/styles.css" />
  <script defer src="/nav.js"></script>
  <script defer src="/script.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <h1>IA Image Enhancer</h1>
      <p class="tagline">Mejora, vectoriza y más — todo local.</p>
    </div>

    <nav class="tabs" aria-label="Herramientas">
      <a href="#/enhance" data-view="enhance" class="tab">Mejorar</a>
      <a href="#/vectorize" data-view="vectorize" class="tab">Vectorización</a>
      <a href="#/halftone" data-view="halftone" class="tab disabled" aria-disabled="true" title="Próximamente">Semitonos</a>
      <a href="#/bgremove" data-view="bgremove" class="tab disabled" aria-disabled="true" title="Próximamente">Quitar fondo</a>
      <a href="#/more" data-view="more" class="tab disabled" aria-disabled="true" title="Próximamente">Más</a>
    </nav>
  </header>

  <main class="app-main">
    <!-- Sidebar: uploader + acciones -->
    <aside class="sidebar">
      <section class="panel">
        <div class="uploader" id="dropzone">
          <input type="file" id="fileInput" accept="image/png,image/jpeg,image/webp,image/tiff" />
          <p>Arrastra una imagen aquí o <label for="fileInput" class="link">haz clic para seleccionar</label></p>
        </div>

        <div class="actions">
          <button id="btnUpload" class="btn">Cargar imagen</button>
          <a id="btnDownload" class="btn secondary" href="#" download style="display:none">Descargar</a>
        </div>
      </section>
    </aside>

    <!-- Workspace -->
    <section class="workspace">

      <!-- ====== MEJORAR ====== -->
      <div id="view-enhance" class="view" role="region" aria-labelledby="tab-enhance">
        <div class="controls-grid">
          <div class="controls">
            <h3>Mejorar imagen</h3>

            <!-- NUEVO: Preview mini de entrada (MEJORAR) -->
            <div class="input-card" id="enhInputBox">
              <div class="input-thumb">
                <img id="enhInputThumb" alt="miniatura" />
              </div>
              <div class="input-meta">
                <div class="name" id="enhInputName">Sin archivo</div>
                <div class="meta" id="enhInputMeta">—</div>
                <button id="enhPick" class="btn tiny">Cambiar imagen</button>
              </div>
            </div>

            <label>Escala
              <select id="scale">
                <option value="1">1x (rápida)</option>
                <option value="2">2x (IA si hay modelo)</option>
                <option value="4">4x (IA si hay modelo)</option>
              </select>
            </label>

            <label>Ruido <span id="denoiseVal">0</span>
              <input type="range" id="denoise" min="0" max="100" value="0" />
            </label>

            <label>Nitidez <span id="sharpenVal">1.0</span>
              <input type="range" id="sharpen" min="0" max="3" step="0.1" value="1.0" />
            </label>

            <label>Formato
              <select id="format">
                <option value="png">PNG</option>
                <option value="jpg">JPG</option>
                <option value="webp">WEBP</option>
                <option value="pdf">PDF</option>
              </select>
            </label>

            <label>Presets
              <select id="preset">
                <option value="none">Ninguno</option>
                <option value="doc_texto">Documento / Texto</option>
                <option value="ui_screen">UI / Captura de pantalla</option>
                <option value="foto_texto">Foto con Texto</option>
                <option value="microtext">Microtexto extremo</option>
              </select>
            </label>

            <label class="row">
              <input type="checkbox" id="textMode" />
              <span>Modo Texto Nítido</span>
            </label>

            <label>Detalle (0–100) <span id="detailVal">50</span>
              <input type="range" id="detailLevel" min="0" max="100" value="50" />
            </label>

            <!-- Anti-blur -->
            <label class="row">
              <input type="checkbox" id="deblur" />
              <span>Anti-blur (deconvolución)</span>
            </label>
            <label>Radio blur (px)
              <input type="number" id="deblurRadius" min="0.6" step="0.1" value="1.6" />
            </label>
            <label>Regularización (λ)
              <input type="number" id="deblurLambda" min="0.001" step="0.001" value="0.01" />
            </label>

            <label>Detalle multiescala (0–1)
              <input type="number" id="msAmount" min="0" max="1" step="0.05" value="0.6" />
            </label>

            <!-- NLM / Anti-ringing -->
            <label>Reducción de ruido (NLM) 0–30
              <input type="number" id="nlm" min="0" max="30" step="1" value="12" />
            </label>
            <label class="row">
              <input type="checkbox" id="nlmChroma" checked />
              <span>Denoise solo color (croma)</span>
            </label>
            <label>Anti-ringing (0–1)
              <input type="number" id="antiring" min="0" max="1" step="0.05" value="0.25" />
            </label>

            <!-- Anti-halo y papel -->
            <label class="row">
              <input type="checkbox" id="edgeclip" checked />
              <span>Anti-halo (Edge-Clip)</span>
            </label>
            <label>Fuerza Edge-Clip (0–1.2)
              <input type="number" id="edgeclipAmt" min="0" max="1.2" step="0.05" value="0.55" />
            </label>
            <label>Límite relativo (0.01–0.03)
              <input type="number" id="edgeclipClip" min="0.01" max="0.03" step="0.001" value="0.015" />
            </label>
            <label>Aplanar fondo (papel) 0–1
              <input type="number" id="paperSmooth" min="0" max="1" step="0.05" value="0.25" />
            </label>

            <div id="textControls" style="display:none; grid-column: 1 / -1;">
              <div class="grid">
                <label>CLAHE clip (1–6)
                  <input type="number" id="claheClip" min="1" max="6" step="0.5" value="2.5" />
                </label>
                <label>CLAHE tiles (4–16)
                  <input type="number" id="claheTile" min="4" max="16" step="1" value="8" />
                </label>
                <label>Guided radius (2–12)
                  <input type="number" id="guidedRadius" min="2" max="12" step="1" value="6" />
                </label>
                <label>Guided eps (1e-7–1e-3)
                  <input type="number" id="guidedEps" step="0.0000001" value="0.000001" />
                </label>
                <label>Nitidez texto (0–1)
                  <input type="number" id="textSharpen" min="0" max="1" step="0.1" value="0.6" />
                </label>
                <label>Boost Laplaciano (0–0.6)
                  <input type="number" id="lapAmount" min="0" max="0.6" step="0.05" value="0.25" />
                </label>
                <label>Downscale final
                  <select id="finalDownscale">
                    <option value="1">1.0</option>
                    <option value="0.75">0.75</option>
                    <option value="0.5">0.5</option>
                  </select>
                </label>
              </div>
              <small>Tip: Para letras finas usa escala 4x + downscale 0.5.</small>
            </div>

            <button id="btnProcess">Mejorar</button>
          </div>

          <!-- Lienzos + métricas -->
          <section class="canvas-wrap">
            <div>
              <h3>Original</h3>
              <canvas id="canvasOriginal"></canvas>
            </div>

            <div>
              <h3>Mejorada</h3>
              <canvas id="canvasResult"></canvas>

              <div class="metrics-card" id="detailPanel">
                <div class="metrics-head">
                  <div>
                    <div class="kicker">Análisis</div>
                    <h4>Niveles de detalle</h4>
                    <p class="sub">Distribución por bandas de frecuencia + densidad de bordes</p>
                  </div>
                  <canvas id="detailSpark" width="240" height="60"></canvas>
                </div>
                <div class="meters">
                  <div class="meter">
                    <span class="label">Alta</span>
                    <div class="bar"><div class="fill hi" id="barHigh" style="width:0%"></div></div>
                    <span class="val" id="valHigh">0%</span>
                  </div>
                  <div class="meter">
                    <span class="label">Media</span>
                    <div class="bar"><div class="fill mid" id="barMid" style="width:0%"></div></div>
                    <span class="val" id="valMid">0%</span>
                  </div>
                  <div class="meter">
                    <span class="label">Baja</span>
                    <div class="bar"><div class="fill low" id="barLow" style="width:0%"></div></div>
                    <span class="val" id="valLow">0%</span>
                  </div>
                  <div class="meter">
                    <span class="label">Bordes</span>
                    <div class="bar"><div class="fill edg" id="barEdge" style="width:0%"></div></div>
                    <span class="val" id="valEdge">0%</span>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>

      <!-- ====== VECTORIZACIÓN ====== -->
      <div id="view-vectorize" class="view" role="region" aria-labelledby="tab-vectorize" hidden>
        <div class="controls-grid">
          <div class="controls">
            <h3>Vectorización</h3>

            <!-- Preview inline de la IMAGEN DE ENTRADA (VECTORIZACIÓN) -->
            <div class="input-card" id="vecInputBox">
              <div class="input-thumb">
                <img id="vecInputThumb" alt="miniatura" />
              </div>
              <div class="input-meta">
                <div class="name" id="vecInputName">Sin archivo</div>
                <div class="meta" id="vecInputMeta">—</div>
                <button id="vecPick" class="btn tiny">Cambiar imagen</button>
              </div>
            </div>

            <label>Modo
              <select id="vecMode">
                <option value="mono">Blanco y negro (contornos)</option>
                <option value="color">Color (k-means)</option>
              </select>
            </label>

            <label>Colores (2–16)
              <input type="number" id="vecColors" min="2" max="16" step="1" value="6">
            </label>

            <label>Suavizado SVG (ε px)
              <input type="number" id="vecSmooth" min="0" step="0.5" value="2.0">
            </label>

            <label>Área mínima (px²)
              <input type="number" id="vecMinArea" min="1" step="1" value="25">
            </label>

            <label>Formato
              <select id="vecFormat">
                <option value="svg">SVG</option>
                <option value="pdf">PDF</option>
              </select>
            </label>

            <label style="display:flex; align-items:center; gap:.5rem;">
              <input type="checkbox" id="fastMode" checked>
              <span>Modo Turbo (rápido)</span>
            </label>

            <div class="row gap">
              <button id="btnVectorize" class="btn">Vectorizar</button>
              <a id="vecDownload" class="btn secondary" href="#" download style="display:none">Descargar</a>
            </div>

            <small>
              Tip: si el SVG sale con muchas piezas pequeñas, sube el <b>Área mínima</b> o el <b>Suavizado</b>.
              Para PDF: <code>pip install cairosvg</code>.
            </small>
          </div>

          <!-- Resultado inline -->
          <section class="canvas-wrap">
            <div>
              <h3>Resultado</h3>
              <div id="vecPreview" class="preview-area" style="min-height:360px;border:1px dashed var(--border);padding:8px;overflow:auto;"></div>
            </div>
          </section>
        </div>
      </div>

      <!-- ====== PLACEHOLDERS ====== -->
      <div id="view-halftone" class="view" role="region" hidden>
        <div class="placeholder">
          <h3>Semitonos (próximamente)</h3>
          <p>Esta sección aparecerá aquí cuando la implementemos.</p>
        </div>
      </div>

      <div id="view-bgremove" class="view" role="region" hidden>
        <div class="placeholder">
          <h3>Quitar fondo (próximamente)</h3>
          <p>Se integrará rembg/onnx aquí con controles y descarga en PNG transparente.</p>
        </div>
      </div>

      <div id="view-more" class="view" role="region" hidden>
        <div class="placeholder">
          <h3>Más herramientas (próximamente)</h3>
          <p>Espacio reservado para nuevas funciones.</p>
        </div>
      </div>

    </section>
  </main>

  <footer class="app-footer">
    <small>Funciona localmente. Nada se sube a la nube.</small>
  </footer>
</body>
</html>
